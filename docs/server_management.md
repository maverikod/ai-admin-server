# AI Admin Server Management

## Обзор

Скрипт `manage_ai_admin.py` предоставляет полный контроль над AI Admin сервером:
- Проверка состояния и мониторинг
- Запуск и остановка сервера
- Просмотр логов
- Управление процессами

## Быстрый старт

```bash
# Показать справку (по умолчанию)
./manage_ai_admin.py

# Проверить статус сервера
./manage_ai_admin.py status

# Запустить сервер
./manage_ai_admin.py start

# Остановить сервер
./manage_ai_admin.py stop

# Перезапустить сервер
./manage_ai_admin.py restart
```

## Команды

### `status` или `s`
Показывает полную информацию о состоянии сервера:
- Статус запуска (запущен/остановлен)
- PID процесса
- Время работы
- Использование ресурсов (CPU, память)
- Статус порта
- Наличие файлов (PID, логи, конфигурация)

```bash
./manage_ai_admin.py status
```

### `start`
Запускает сервер в фоновом режиме:
- Проверяет, не запущен ли уже сервер
- Проверяет доступность порта
- Запускает процесс в фоне
- Сохраняет PID в файл
- Перенаправляет логи в файл

```bash
# Запуск на порту по умолчанию (8000)
./manage_ai_admin.py start

# Запуск на другом порту
./manage_ai_admin.py start --port 8080

# Запуск в foreground режиме
./manage_ai_admin.py start --foreground
```

### `stop`
Graceful остановка сервера:
- Отправляет SIGTERM
- Ждет завершения (до 10 секунд)
- Принудительно завершает при необходимости
- Удаляет PID файл

```bash
./manage_ai_admin.py stop
```

### `kill`
Принудительная остановка сервера:
- Отправляет SIGKILL
- Немедленное завершение процесса
- Удаляет PID файл

```bash
./manage_ai_admin.py kill
```

### `restart` или `r`
Перезапуск сервера:
- Останавливает текущий процесс
- Ждет завершения
- Запускает новый процесс

```bash
./manage_ai_admin.py restart
```

### `logs` или `l`
Показывает логи сервера:
- Отображает последние строки логов
- Настраиваемое количество строк

```bash
# Последние 50 строк (по умолчанию)
./manage_ai_admin.py logs

# Последние 100 строк
./manage_ai_admin.py logs --lines 100
```

### `follow` или `f`
Следит за логами в реальном времени:
- Отображает новые записи по мере появления
- Ctrl+C для выхода

```bash
./manage_ai_admin.py follow
```

## Опции

### `--port PORT`
Указывает порт для сервера (по умолчанию: 8000)

### `--host HOST`
Указывает хост для сервера (по умолчанию: 0.0.0.0)

### `--lines N`
Количество строк логов для отображения (по умолчанию: 50)

### `--foreground`
Запускает сервер в foreground режиме (не в фоне)

### `--help` или `-h`
Показывает справку

## Файлы

### PID файл
`/tmp/ai_admin_server.pid`
- Содержит PID запущенного сервера
- Автоматически создается при запуске
- Автоматически удаляется при остановке

### Лог файл
`/tmp/ai_admin_server.log`
- Содержит все логи сервера
- Автоматически создается при запуске
- Может быть очищен вручную

### Конфигурационный файл
`config/config.json`
- Основная конфигурация сервера
- Должен существовать для корректной работы

## Примеры использования

### Полный цикл работы
```bash
# 1. Проверяем статус
./manage_ai_admin.py status

# 2. Запускаем сервер
./manage_ai_admin.py start

# 3. Проверяем, что запустился
./manage_ai_admin.py status

# 4. Смотрим логи
./manage_ai_admin.py logs

# 5. Следим за логами в реальном времени
./manage_ai_admin.py follow

# 6. Останавливаем сервер
./manage_ai_admin.py stop
```

### Отладка проблем
```bash
# Проверяем статус
./manage_ai_admin.py status

# Если порт занят другим процессом
./manage_ai_admin.py start --port 8080

# Если сервер завис, принудительно останавливаем
./manage_ai_admin.py kill

# Смотрим логи для диагностики
./manage_ai_admin.py logs --lines 200
```

### Разработка
```bash
# Запуск в foreground для отладки
./manage_ai_admin.py start --foreground

# Быстрый перезапуск при изменениях
./manage_ai_admin.py restart
```

## Безопасность

- Скрипт проверяет, не запущен ли уже сервер
- Проверяет доступность порта перед запуском
- Использует PID файлы для отслеживания процессов
- Graceful остановка с fallback на принудительную
- Логирование всех операций

## Устранение неполадок

### Сервер не запускается
1. Проверьте статус: `./manage_ai_admin.py status`
2. Проверьте логи: `./manage_ai_admin.py logs`
3. Убедитесь, что порт свободен
4. Проверьте наличие конфигурационного файла

### Сервер завис
1. Попробуйте graceful остановку: `./manage_ai_admin.py stop`
2. Принудительно остановите: `./manage_ai_admin.py kill`
3. Проверьте логи для диагностики

### Порт занят
1. Проверьте, какой процесс использует порт
2. Используйте другой порт: `--port 8080`
3. Остановите конфликтующий процесс

### Проблемы с правами доступа
1. Убедитесь, что скрипт исполняемый: `chmod +x manage_ai_admin.py`
2. Проверьте права на запись в `/tmp`
3. Убедитесь, что Python доступен в PATH 