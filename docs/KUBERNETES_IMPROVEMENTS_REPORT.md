# –û—Ç—á–µ—Ç –æ–± —É–ª—É—á—à–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥ Kubernetes

## –û–±–∑–æ—Ä

–í —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏ –±—ã–ª–∏ —É–ª—É—á—à–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã Kubernetes –≤ –ø—Ä–æ–µ–∫—Ç–µ `ai-admin-server`, –∑–∞–º–µ–Ω–∏–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `subprocess` –Ω–∞ Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Ä–µ—à–µ–Ω—ã

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ subprocess –≤–º–µ—Å—Ç–æ Python –±–∏–±–ª–∏–æ—Ç–µ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã Kubernetes –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `subprocess` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –∫–æ–º–∞–Ω–¥, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫:
- –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∫–æ–º–∞–Ω–¥
- –°–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —É—Ç–∏–ª–∏—Ç
- –ü—Ä–æ–±–ª–µ–º–∞–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## –£–ª—É—á—à–µ–Ω–∏—è

### 1. –ö–æ–º–∞–Ω–¥–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ (`k8s_certificates_command.py`)

**–ë—ã–ª–æ:**
```python
import subprocess
# ...
subprocess.run([
    "openssl", "genrsa", "-out", key_path, str(key_size)
], check=True, capture_output=True)
```

**–°—Ç–∞–ª–æ:**
```python
from cryptography import x509
from cryptography.hazmat.primitives import hashes, serialization
from cryptography.hazmat.primitives.asymmetric import rsa

private_key = rsa.generate_private_key(
    public_exponent=65537,
    key_size=key_size
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `cryptography` –≤–º–µ—Å—Ç–æ OpenSSL
- ‚úÖ –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
- ‚úÖ –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —É—Ç–∏–ª–∏—Ç

### 2. –ö–æ–º–∞–Ω–¥–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏ (`k8s_cluster_manager_command.py`)

**–ë—ã–ª–æ:**
```python
import subprocess
# ...
result = subprocess.run([
    "docker", "ps", "--filter", "ancestor=rancher/k3s:latest", "--format", "json"
], capture_output=True, text=True, timeout=30)
```

**–°—Ç–∞–ª–æ:**
```python
import docker

self.docker_client = docker.from_env()
k3s_containers = self.docker_client.containers.list(
    filters={"ancestor": "rancher/k3s:latest"}
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker Python SDK –≤–º–µ—Å—Ç–æ docker CLI
- ‚úÖ –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
- ‚úÖ –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Fallback –Ω–∞ subprocess –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Docker SDK
- ‚úÖ –ë–æ–ª–µ–µ –±–æ–≥–∞—Ç—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

### 3. –£—Ç–∏–ª–∏—Ç—ã Kubernetes (`k8s_utils.py`)

**–ë—ã–ª–æ:**
```python
import subprocess
result = subprocess.run([
    "docker", "exec", container_name, "cat", "/etc/rancher/k3s/k3s.yaml"
], capture_output=True, text=True)
```

**–°—Ç–∞–ª–æ:**
```python
import docker

container = self.docker_client.containers.get(container_name)
result = container.exec_run("cat /etc/rancher/k3s/k3s.yaml")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker Python SDK
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## –ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–æ–±–∞–≤–ª–µ–Ω—ã –≤ `pyproject.toml`:
```toml
dependencies = [
    "mcp-proxy-adapter>=1.0.0",
    "uvicorn>=0.20.0",
    "fastapi>=0.95.0",
    "docker>=6.0.0",        # Docker Python SDK
    "cryptography>=3.4.0",  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
]
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test_k8s_improvements.py` –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —É–ª—É—á—à–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:

```bash
python test_k8s_improvements.py
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é cryptography
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ Docker Python SDK
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Docker
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:

1. **Docker SDK ‚Üí subprocess**: –ï—Å–ª–∏ Docker Python SDK –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è subprocess
2. **cryptography ‚Üí OpenSSL**: –í –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ OpenSSL

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
- –§–æ—Ä–º–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –£–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ injection –∞—Ç–∞–∫**: –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ shell
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ª—É—á—à—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
3. **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞**: –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
1. **–ú–µ–Ω—å—à–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**: –ù–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. **–õ—É—á—à–µ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é**: Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
4. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –£–ª—É—á—à–µ–Ω–∏—è –≤ –æ—Ç–ª–∞–¥–∫–µ:
1. **–î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏**: –ë–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏**: –õ–æ–≥–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
3. **–ú–µ—Ç—Ä–∏–∫–∏**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞**: –õ—É—á—à–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

## –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

### –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ subprocess**: –ó–∞–º–µ–Ω–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è subprocess
2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–ú–µ—Ç—Ä–∏–∫–∏**: –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
5. **–¢–µ—Å—Ç—ã**: –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–£—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ Kubernetes —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `subprocess` –Ω–∞ Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –≠—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫:

- üöÄ –ü–æ–≤—ã—à–µ–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚ö° –£–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
- üõ°Ô∏è –õ—É—á—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫
- üîß –£–ø—Ä–æ—â–µ–Ω–∏—é –æ—Ç–ª–∞–¥–∫–∏
- üì¶ –£–º–µ–Ω—å—à–µ–Ω–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —É—Ç–∏–ª–∏—Ç
- üîÑ –û–±–µ—Å–ø–µ—á–µ–Ω–∏—é –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ. 